{"version":3,"sources":["Swiper.tsx"],"names":["React","StyleSheet","View","getIndexFromVerticalOffset","getMonthHeight","getVerticalMonthsOffset","montHeaderHeight","beginOffset","estimatedMonthHeight","totalMonths","useLatest","useYearChange","AutoSizer","Swiper","scrollMode","renderItem","renderHeader","renderFooter","selectedYear","initialIndex","isHorizontal","index","setIndex","useState","onPrev","useCallback","prev","onNext","renderProps","indexRef","newIndex","currentIndexRef","styles","flex1","width","height","visibleArray","i","VerticalScroller","estimatedHeight","idx","useRef","visibleIndexes","setVisibleIndexes","parentRef","useIsomorphicLayoutEffect","element","current","top","scrollTo","setVisibleIndexesThrottled","useDebouncedCallback","onScroll","e","currentTarget","scrollTop","offset","overflow","position","map","vi","willChange","transform","left","right","empty","create","flex","callback","mounted","latest","timerId","useEffect","window","cancelAnimationFrame","args","requestAnimationFrame","useLayoutEffect","memo"],"mappings":"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","sourcesContent":["import * as React from 'react'\nimport { StyleSheet, View } from 'react-native'\n\nimport {\n  getIndexFromVerticalOffset,\n  getMonthHeight,\n  getVerticalMonthsOffset,\n  montHeaderHeight,\n} from './Month'\n\nimport { beginOffset, estimatedMonthHeight, totalMonths } from './dateUtils'\nimport { useLatest } from '../utils'\nimport { RenderProps, SwiperProps, useYearChange } from './SwiperUtils'\nimport AutoSizer from './AutoSizer'\n\nfunction Swiper({\n  scrollMode,\n  renderItem,\n  renderHeader,\n  renderFooter,\n  selectedYear,\n  initialIndex,\n}: SwiperProps) {\n  const isHorizontal = scrollMode === 'horizontal'\n  const [index, setIndex] = React.useState(initialIndex)\n\n  const onPrev = React.useCallback(() => {\n    setIndex((prev) => prev - 1)\n  }, [setIndex])\n\n  const onNext = React.useCallback(() => {\n    setIndex((prev) => prev + 1)\n  }, [setIndex])\n\n  const renderProps = {\n    index,\n    onPrev,\n    onNext,\n  }\n  const indexRef = useLatest(index)\n  useYearChange(\n    (newIndex) => {\n      if (newIndex) {\n        setIndex(newIndex)\n      }\n    },\n    {\n      selectedYear,\n      currentIndexRef: indexRef,\n    }\n  )\n\n  return (\n    <>\n      {renderHeader && renderHeader(renderProps)}\n      {isHorizontal ? (\n        <View style={styles.flex1}>\n          {renderItem({ index, onPrev, onNext })}\n        </View>\n      ) : (\n        <AutoSizer>\n          {({ width, height }) => (\n            <VerticalScroller\n              width={width}\n              height={height}\n              initialIndex={initialIndex}\n              estimatedHeight={estimatedMonthHeight}\n              renderItem={renderItem}\n            />\n          )}\n        </AutoSizer>\n      )}\n      {renderFooter && renderFooter(renderProps)}\n    </>\n  )\n}\n\nconst visibleArray = (i: number) => [i - 2, i - 1, i, i + 1, i + 2]\n\nfunction VerticalScroller({\n  width,\n  height,\n  initialIndex,\n  estimatedHeight,\n  renderItem,\n}: {\n  renderItem: (renderProps: RenderProps) => any\n  width: number\n  height: number\n  initialIndex: number\n  estimatedHeight: number\n}) {\n  const idx = React.useRef<number>(initialIndex)\n  const [visibleIndexes, setVisibleIndexes] = React.useState<number[]>(\n    visibleArray(initialIndex)\n  )\n  // eslint-disable-next-line no-undef\n  const parentRef = React.useRef<HTMLDivElement | null>(null)\n\n  useIsomorphicLayoutEffect(() => {\n    const element = parentRef.current\n    if (!element) {\n      return\n    }\n    const top = getVerticalMonthsOffset(idx.current) - montHeaderHeight\n\n    element.scrollTo({\n      top,\n    })\n  }, [parentRef, idx])\n\n  const setVisibleIndexesThrottled = useDebouncedCallback(setVisibleIndexes)\n\n  const onScroll = React.useCallback(\n    (e: React.UIEvent) => {\n      const top = e.currentTarget.scrollTop\n      if (top === 0) {\n        return\n      }\n\n      const offset = top - beginOffset\n      const index = getIndexFromVerticalOffset(offset)\n\n      if (idx.current !== index) {\n        idx.current = index\n        setVisibleIndexesThrottled(visibleArray(index))\n      }\n    },\n    [setVisibleIndexesThrottled]\n  )\n\n  return (\n    <div\n      ref={parentRef}\n      style={{\n        height,\n        width,\n        overflow: 'auto',\n      }}\n      onScroll={onScroll}\n    >\n      <div\n        style={{\n          height: estimatedHeight * totalMonths,\n          position: 'relative',\n        }}\n      >\n        {[0, 1, 2, 3, 4].map((vi) => (\n          <div\n            key={vi}\n            style={{\n              willChange: 'transform',\n              transform: `translateY(${getVerticalMonthsOffset(\n                visibleIndexes[vi]\n              )}px)`,\n              left: 0,\n              right: 0,\n              position: 'absolute',\n              height: getMonthHeight('vertical', visibleIndexes[vi]),\n              // transform: `translateY(${getMonthsOffset('vertical', vi)}px)`,\n            }}\n          >\n            {renderItem({\n              index: visibleIndexes[vi],\n              onPrev: empty,\n              onNext: empty,\n            })}\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n\nconst empty = () => null\n\nconst styles = StyleSheet.create({\n  flex1: {\n    flex: 1,\n  },\n})\n\nexport function useDebouncedCallback(callback: any): any {\n  const mounted = React.useRef<boolean>(true)\n  const latest = useLatest(callback)\n  const timerId = React.useRef<any>(null)\n\n  React.useEffect(() => {\n    return () => {\n      mounted.current = false\n      if (timerId.current) {\n        window.cancelAnimationFrame(timerId.current)\n      }\n    }\n  }, [mounted, timerId])\n\n  return React.useCallback(\n    (args: any) => {\n      if (timerId.current) {\n        window.cancelAnimationFrame(timerId.current)\n      }\n      timerId.current = window.requestAnimationFrame(function () {\n        if (mounted.current) {\n          latest.current(args)\n        }\n      })\n    },\n    [mounted, timerId, latest]\n  )\n}\n\nconst useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect\n\nexport default React.memo(Swiper)\n"]}